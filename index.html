<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Portfolio</title>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
    <style>
        /* --- ÂÖ±ÈÄöÂ§âÊï∞ --- */
        :root {
            --body-bg: #111;
            --screen-bg: #0b0f14; 
            --text-color: #f0f0f0;
            --accent-color: #88FFAA; 
            --badge-color: #ff6b00; /* ÈÄöÁü•„Éà„Çô„ÉÉ„ÉàËâ≤ */
        }

        body {
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'DotGothic16', sans-serif;
            color: var(--text-color);
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        .phone-wrapper {
            width: 310px;
            display: flex;
            flex-direction: column;
            gap: 0; 
            perspective: 1000px;
        }

        /* --- ‰∏äÁîªÈù¢ (Texture: Noise) --- */
        .phone-top {
            background: linear-gradient(135deg, #444 0%, #222 100%);
            border-radius: 12px;
            padding: 4px;
            box-shadow: 
                0 0 0 1px #111,
                5px 10px 25px rgba(0,0,0,0.7),
                inset 1px 1px 1px rgba(255,255,255,0.3);
            border: 1px solid #000;
            position: relative;
            margin-bottom: 2px;
        }

        .inner-panel-top {
            background: linear-gradient(to bottom, #3a3a3a, #2a2a2a);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid #555;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
            position: relative; overflow: hidden;
        }
        .inner-panel-top::before {
            content: "";
            position: absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:0.08;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='1'/%3E%3C/svg%3E");
        }

        /* Ê∂≤Êô∂ÁîªÈù¢ */
        .screen-frame {
            background-color: #000;
            border-radius: 4px;
            padding: 2px;
            box-shadow: 0 0 0 1px #666;
            position: relative; z-index: 1;
        }

        .screen {
            background-color: var(--screen-bg);
            width: 100%;
            height: 320px;
            overflow: hidden;
            position: relative;
            image-rendering: pixelated;
            border: 1px solid #1a1a1a;
            box-shadow: 
                inset 0 0 0 1px rgba(255,255,255,0.1),
                inset 0 0 20px rgba(0,0,0,1);
        }

        .screen::before {
            content: "";
            position: absolute; top: 0; left: 0; width: 100%; height: 35%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.08), transparent);
            pointer-events: none; z-index: 10;
        }

        /* „Çπ„ÉÜ„Éº„Çø„Çπ„Éè„Çô„Éº */
        .status-bar {
            height: 32px;
            background: linear-gradient(to bottom, rgba(10, 25, 40, 0.9), rgba(0, 15, 30, 0.85));
            display: flex; justify-content: space-between; align-items: flex-start;
            padding: 4px 6px;
            color: #fff; position: relative; z-index: 5;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .status-left { display: flex; align-items: center; gap: 6px; padding-top: 2px;
        }
        
        /* Battery */
        .battery-icon { width: 14px;
            height: 8px; border: 1px solid #aaa; padding: 1px; position: relative; display: inline-block; margin-right: 2px;
        }
        .battery-level { width: 60%; height: 100%; background: linear-gradient(to bottom, #4f4, #0a0);
        }
        .battery-icon::after { content: ""; position: absolute; right: -3px; top: 2px; width: 2px;
            height: 4px; background: #aaa; }

        /* Signal Icon */
        .signal {
            position: relative;
            display: inline-flex; align-items: flex-end; justify-content: space-between; gap: 1px;
            width: 15px; height: 11px; padding: 1px 2px; box-sizing: border-box;
            border: 1px solid rgba(255,255,255,0.55); border-radius: 2px;
        }
        .signal .bar { width: 2px;
            background: rgba(255,255,255,0.9); opacity: 0.2; border-radius: 1px 1px 0 0; }
        .signal .b1{ height: 2px;
        } .signal .b2{ height: 4px; } .signal .b3{ height: 6px; } .signal .b4{ height: 8px;
        }
        .signal[data-level="0"] .bar{ opacity: 0.15;
        }
        .signal[data-level="1"] .b1{ opacity: 1;
        }
        .signal[data-level="2"] .b1,.signal[data-level="2"] .b2{ opacity: 1;
        }
        .signal[data-level="3"] .b1,.signal[data-level="2"] .b2,.signal[data-level="3"] .b3{ opacity: 1;
        }
        .signal[data-level="4"] .bar{ opacity: 1;
        }
        .signal .x { position: absolute; right: -6px; bottom: -3px; font-size: 10px;
            line-height: 1; font-family: sans-serif; font-weight: bold; color: #f55; opacity: 0; text-shadow: 1px 1px 0 #000;
        }
        .signal[data-mode="noservice"] .bar{ opacity: 0.1; } .signal[data-mode="noservice"] .x{ opacity: 1;
        }
        @keyframes sigScan { 0%{ opacity: 0.2; } 50%{ opacity: 1;
        } 100%{ opacity: 0.2; } }
        .signal[data-mode="search"] .bar{ opacity: 0.2;
        }
        .signal[data-mode="search"] .b1{ animation: sigScan 0.8s infinite;
        }
        .signal[data-mode="search"] .b2{ animation: sigScan 0.8s 0.15s infinite;
        }
        .signal[data-mode="search"] .b3{ animation: sigScan 0.8s 0.30s infinite;
        }
        .signal[data-mode="search"] .b4{ animation: sigScan 0.8s 0.45s infinite;
        }

        .status-right { display: flex; flex-direction: column; align-items: flex-end; line-height: 1;
        }
        .date-text { font-size: 9px; color: #ccc; margin-bottom: 2px;
        }
        .time-text { font-size: 14px; font-weight: bold; color: #fff;
            text-shadow: 0 0 2px rgba(255,255,255,0.5); }
        .status-mode-icon { width: 6px; height: 12px;
            background: linear-gradient(to bottom, #0af 50%, #f80 50%); margin-left: 2px; display: inline-block; vertical-align: top;
        }

        /* „ÇΩ„Éï„Éà„Ç≠„Éº„Ç´„Çô„Ç§„Éà„Çô */
        .soft-keys {
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 26px;
            background: #000; display: flex; border-top: 1px solid #333; z-index: 20;
        }
        .soft-key-btn {
            flex: 1;
            display: flex; justify-content: center; align-items: center;
            font-size: 11px; color: #fff; border-right: 1px solid #333;
            background: linear-gradient(to bottom, #222, #000);
            text-shadow: 0 1px 0 #000;
        }
        .soft-key-btn:last-child { border-right: none;
        }
        .soft-key-btn:nth-child(2) { font-weight: bold;
        }

        /* „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢ */
        #home-view { 
            padding-bottom: 30px;
            transition: opacity 0.1s; 
            opacity: 1;
        }
        
        .app-grid { 
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px; 
            padding: 10px 4px;
            margin-top: 2px;
        }
        
        .app-icon { 
            display: flex;
            flex-direction: column; align-items: center; 
            cursor: pointer; padding: 2px; 
            border-radius: 6px;
            border: 2px solid transparent; 
            position: relative;
            /* „Éè„Çô„ÉÉ„Ç∑„ÇôÁî® */
        }
        
        .app-icon.selected {
            border: 2px solid var(--accent-color);
            background-color: rgba(136, 255, 170, 0.15);
            box-shadow: inset 0 0 10px rgba(136, 255, 170, 0.4);
            animation: selectBlink 1.1s infinite alternate;
        }
        
        .app-icon.selected .icon-img {
            transform: scale(1.05);
            transition: transform 0.1s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: rgba(255,255,255,0.08);
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        /* --- Badge (ÈÄöÁü•„Éà„Çô„ÉÉ„Éà) --- */
        .app-badge {
            position: absolute;
            top: 4px;
            right: 8px;
            width: 8px;
            height: 8px;
            background-color: var(--badge-color);
            border-radius: 50%;
            border: 1px solid #000;
            box-shadow: 0 1px 2px rgba(0,0,0,0.5);
            z-index: 10;
        }

        @keyframes selectBlink { 
            from { border-color: rgba(136, 255, 170, 0.4);
                box-shadow: inset 0 0 5px rgba(136, 255, 170, 0.2); } 
            to { border-color: var(--accent-color);
                box-shadow: inset 0 0 12px rgba(136, 255, 170, 0.5); } 
        }

        .icon-img { 
            width: 76px;
            height: 76px; 
            margin-bottom: 2px; 
            display: flex;
            align-items: center; justify-content: center; 
            background: rgba(255,255,255,0.03); 
            border-radius: 14px;
        }
        
        .icon-png { 
            width: 90%;
            height: 90%; 
            object-fit: contain; image-rendering: pixelated;
        }

        .icon-fallback { font-size: 32px; color: #888;
        } 

        .icon-label { font-size: 10px; text-align: center; width: 100%;
            overflow: hidden;
            white-space: nowrap; text-overflow: ellipsis; text-shadow: 1px 1px 0 #000;
        }
        .page-indicator { position: absolute;
            bottom: 32px; right: 10px; font-size: 10px; color: #888;
        }

        /* --- Ë©≥Á¥∞ÁîªÈù¢ --- */
        .detail-view { 
            display: none;
            position: absolute; top: 40px; left: 0; width: 100%; height: calc(100% - 66px); 
            background-color: #111; padding: 10px; box-sizing: border-box; 
            z-index: 15;
            transition: opacity 0.1s; opacity: 0;
            overflow-y: auto; overflow-x: hidden;
            scrollbar-width: none;
        }
        .detail-view::-webkit-scrollbar { display: none;
        }

        .detail-title { color: var(--accent-color); border-bottom: 1px solid var(--accent-color); margin-bottom: 10px; font-size: 14px;
        }
        
        .detail-item { margin-bottom: 15px;
            display: block; position: relative; }

        .img-container {
            position: relative;
            width: 100%; border: 1px solid #333; overflow: hidden; 
        }
        
        .detail-img { width: 100%;
            display: block; image-rendering: pixelated; }

        .detail-item.focused .img-container {
            border: 2px solid var(--accent-color);
            box-shadow: 0 0 5px var(--accent-color);
        }

        .img-curtain {
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 100%;
            background-color: #000; border-top: 1px solid var(--accent-color); z-index: 10;
        }

        .detail-desc { font-size: 12px; line-height: 1.6; color: #ddd; margin-bottom: 15px;
            padding: 0 4px; }
        
        .note-link { 
            color: #0ff;
            text-decoration: none; border: 1px solid #0ff; padding: 4px 10px; font-size: 12px; 
            background: rgba(0,255,255,0.1); border-radius: 2px; display: inline-block;
        }
        
        .detail-item.focused .note-link {
            background: var(--accent-color);
            color: #000; border-color: var(--accent-color);
            box-shadow: 0 0 5px var(--accent-color); font-weight: bold;
        }

        /* „Éí„É≥„Ç∑„Çô */
        .hinge { height: 6px;
            background: linear-gradient(to right, #111, #333, #111); margin: 0 10px; z-index: -1; border-left: 1px solid #000; border-right: 1px solid #000;
        }

        /* --- ‰∏ã„Ç≠„Éº„Éè„Çö„ÉÉ„Éà„Çô --- */
        .phone-bottom {
            background: #111;
            border-radius: 12px; padding: 2px;
            box-shadow: 0 0 0 1px #333, inset 1px 1px 1px rgba(255,255,255,0.1);
        }

        .inner-panel-bottom {
            background: #000;
            border-radius: 8px; overflow: hidden; border: 1px solid #000; position: relative;
        }
        .inner-panel-bottom::before {
            content: "";
            position: absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:0; opacity:0.12; mix-blend-mode: overlay;
            background: repeating-linear-gradient(0deg, transparent, transparent 1px, #fff 1px, #fff 2px);
        }

        .controls { display: flex; flex-direction: column; background: #000; padding: 1px; gap: 1px;
            position: relative; z-index: 1; }

        .nav-keys { display: grid; grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 40px 45px 40px; gap: 1px; background: #000; }

        .num-keys { display: grid;
            grid-template-columns: repeat(3, 1fr); gap: 1px; background: #000; margin-top: 1px; }

        .key, .num-key {
            background: linear-gradient(to bottom, #2a2a2a, #1a1a1a);
            color: #ddd; display: flex; justify-content: center; align-items: center;
            font-size: 12px; font-weight: bold; cursor: pointer; user-select: none; position: relative;
            border-radius: 2px;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.08); text-shadow: 0 -1px 0 #000;
        }
        .key:active, .num-key:active, .key.pressed, .num-key.pressed {
            background: #000;
            color: #888; box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
        }

        .key-center {
            background: radial-gradient(circle at 50% 30%, #444, #111);
            border: 1px solid #666; border-radius: 4px; z-index: 10;
            box-shadow: 0 0 0 1px #000, inset 1px 1px 2px rgba(255,255,255,0.3), 0 2px 5px rgba(0,0,0,0.5);
            font-size: 11px; color: #fff; text-shadow: 0 1px 1px #000;
        }
        .key-center:active, .key-center.pressed {
            background: #111;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.8); transform: translateY(1px);
        }

        .key-page { font-size: 10px;
            color: #aaa; border-bottom: 2px solid #005f99; }
        .key-power { color: #e74c3c; font-size: 14px;
            border-bottom: 2px solid #e74c3c; }
        
        .num-key {
            height: 35px;
            position: relative; display: flex; align-items: center; justify-content: center;
            font-family: Arial, sans-serif; font-size: 16px; color: #fff; font-variant-numeric: tabular-nums; line-height: 1;
        }
        .num-main { display: block; transform: translateY(-2px); font-weight: bold;
        }
        .num-sub {
            position: absolute;
            right: 4px; bottom: 3px; font-size: 7px; color: #666; font-weight: normal; pointer-events: none; letter-spacing: -0.5px;
        }
        .logo-text {
            text-align: center;
            font-size: 10px; color: #666; letter-spacing: 2px; margin-top: 5px; font-family: sans-serif;
        }

        /* --- OS Overlays (Update: Wallpaper Support) --- */
        .os-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000;
            /* „ÉÜ„Çô„Éï„Ç©„É´„Éà */
            background-size: cover;
            background-position: center;
            z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: #fff;
            opacity: 0;
            pointer-events: none; transition: opacity 0.3s;
        }
        
        /* ÊöóÂπï (Wallpaper‰∏ä„ÅÆËñÑÊöó„ÅÑ„É¨„Ç§„É§„Éº) */
        .os-overlay::before {
            content: "";
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            /* Êöó„ÅïË™øÊï¥ */
            z-index: -1;
        }

        .os-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        /* Idle Mode Style (Updated) */
        #idle-overlay {
            justify-content: flex-start;
            padding-top: 60px;
        }
        .idle-clock { 
            font-size: 18px;
            /* Êéß„Åà„ÇÅ„Å™„Çµ„Ç§„Çπ„Çô */
            letter-spacing: 1px; color: #fff;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
            font-weight: bold;
        }
        .idle-date {
            font-size: 10px;
            color: #ddd; margin-top: 4px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        }
        .idle-hint { 
            margin-top: auto;
            margin-bottom: 40px;
            font-size: 10px; color: rgba(255,255,255,0.7); 
            animation: blinkText 2s infinite; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        }
        @keyframes blinkText { 0%,100%{opacity:1;} 50%{opacity:0.4;} }

        /* Sleep Mode */
        #sleep-overlay { 
            background-color: #000 !important;
            /* „Çπ„É™„Éº„Éï„Çö„ÅØÁúü„Å£Èªí */
            background-image: none !important;
        }
        .sleep-clock { font-size: 12px; color: #333; position: absolute; bottom: 10px; right: 10px;
        }

        /* Dev Mode (Updated UI) */
        #dev-overlay {
            align-items: flex-start;
            padding: 20px; font-family: monospace; font-size: 10px; line-height: 1.5; color: #0f0;
            background: #000;
        }
        .dev-line { 
            width: 100%;
            border-bottom: 1px solid #003300; margin-bottom: 4px; padding-bottom: 2px;
            display: flex; justify-content: space-between;
        }
        .dev-item {
            padding: 2px 4px;
            color: #0a0;
        }
        .dev-item.selected {
            background: #0f0;
            color: #000;
        }

        /* --- ËøΩÂä†Ê©üËÉΩÁî®„Çπ„Çø„Ç§„É´ --- */
        /* ÈÄöË©±„Ç≠„Éº */
        .key-call {
            color: #4f4; /* Á∑ëËâ≤ */
            font-size: 18px;
        }

        /* Êé•Á∂ö‰∏≠„Ç™„Éº„Éè„Çô„Éº„É¨„Ç§ */
        #connect-overlay {
            display: none;
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 900;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #fff;
        }
        .connect-text {
            font-size: 14px;
            letter-spacing: 2px;
            animation: blink 0.5s infinite alternate;
            margin-bottom: 10px;
        }
        .connect-sub {
            font-size: 10px;
            color: #888;
        }
    </style>
</head>
<body>

<div class="phone-wrapper">
    <div class="phone-top">
        <div class="inner-panel-top">
            <div class="screen-frame">
                <div class="screen">
                    <div class="status-bar">
                        <div class="status-left">
   
                            <div class="battery-icon"><div class="battery-level"></div></div>
                            <div id="signal" class="signal" data-level="4" data-mode="normal">
                                <span class="bar b1"></span><span class="bar b2"></span><span class="bar b3"></span><span class="bar b4"></span>
 
                                <span class="x">√ó</span>
                            </div>
                        </div>
                
                        <div style="display:flex;">
                            <div class="status-right">
                                <div class="date-text" id="date-display">1/1 Mon</div>
                           
                                <div class="time-text" id="clock">12:00</div>
                            </div>
                            <div class="status-mode-icon"></div>
                        </div>
            
                    </div>

                    <div id="idle-overlay" class="os-overlay">
                        <div class="idle-clock" id="idle-clock-disp">12:00</div>
                        <div class="idle-date" id="idle-date-disp">Jan 1</div>
                 
                        <div class="idle-hint">Unlock</div>
                    </div>

                    <div id="sleep-overlay" class="os-overlay">
                        <div class="sleep-clock" id="sleep-clock-disp">12:00</div>
                    </div>

    
                    <div id="dev-overlay" class="os-overlay" style="z-index:200;">
                        <div style="color:#0f0; margin-bottom:10px; width:100%; border-bottom:1px solid #0f0;">[ Developer Menu ]</div>
                        <div id="dev-menu-container" style="width:100%;">
                        </div>
                        <div style="margin-top:auto; width:100%; text-align:center; color:#555; font-size:9px;">
                            build: wallpaper_mod
                        </div>
                    </div>

                    <div id="connect-overlay">
                        <div class="connect-text">Connecting...</div>
                        <div class="connect-sub">Â§ñÈÉ®„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Å∏Êé•Á∂ö‰∏≠</div>
                    </div>

                    <div id="home-view">
   
                        <div class="app-grid" id="app-grid"></div>
                        <div class="page-indicator" id="page-num">1/1</div>
                    </div>

                    <div id="detail-view" class="detail-view">
         
                        <div class="detail-content" id="detail-content"></div>
                    </div>

                    <div class="soft-keys">
                        <div class="soft-key-btn" id="guide-left">‚óÄÔ∏é Ââç„Å∏</div>
               
                        <div class="soft-key-btn" id="guide-center">Ê±∫ÂÆö</div>
                        <div class="soft-key-btn" id="guide-right">Ê¨°„Å∏ ‚ñ∂Ô∏é</div>
                    </div>

                    <div id="boot-screen" style="position:absolute; top:0; left:0; width:100%; height:100%; background:#000; color:#fff; z-index:999; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                        <div style="font-size:24px; letter-spacing:4px; animation:blink 0.8s infinite alternate;">hamamah</div>
                        <div style="font-size:10px; color:#888; margin-top:5px;">Connecting...</div>
                        <style>@keyframes blink { from{opacity:0.4;} to{opacity:1;} }</style>
                    </div>

                </div>
            </div>
            <div class="logo-text">SukimaStock</div>
        </div>
 
    </div>

    <div class="hinge"></div>

    <div class="phone-bottom">
        <div class="inner-panel-bottom">
            <div class="controls">
                
                <div class="nav-keys">
                    <div class="key key-page" id="btn-soft-left">‚óÄÔ∏é Page</div>
        
                    <div class="key" id="btn-up">‚ñ≤</div>
                    <div class="key key-page" id="btn-soft-right">Page ‚ñ∂Ô∏é</div>

                    <div class="key" id="btn-left">‚óÄÔ∏é</div>
                    <div class="key key-center" id="btn-enter">‚óè</div>
                 
                    <div class="key" id="btn-right">‚ñ∂Ô∏é</div>

                    <div class="key key-call" id="btn-call">‚úÜ</div>

                    <div class="key" id="btn-down">‚ñº</div>
                    <div class="key key-power" id="btn-power">‚èª</div>
                </div>

                <div class="num-keys" id="num-keys-container">
                    <div class="num-key" data-key="1"><span class="num-main">1</span><span class="num-sub"></span></div>
                    <div class="num-key" data-key="2"><span class="num-main">2</span><span class="num-sub">ABC</span></div>
                    <div class="num-key" data-key="3"><span class="num-main">3</span><span class="num-sub">DEF</span></div>
                    <div class="num-key" data-key="4"><span class="num-main">4</span><span class="num-sub">GHI</span></div>
                    <div class="num-key" data-key="5"><span class="num-main">5</span><span class="num-sub">JKL</span></div>
 
                    <div class="num-key" data-key="6"><span class="num-main">6</span><span class="num-sub">MNO</span></div>
                    <div class="num-key" data-key="7"><span class="num-main">7</span><span class="num-sub">PQRS</span></div>
                    <div class="num-key" data-key="8"><span class="num-main">8</span><span class="num-sub">TUV</span></div>
                    <div class="num-key" data-key="9"><span class="num-main">9</span><span class="num-sub">WXYZ</span></div>
     
                    <div class="num-key" data-key="*"><span class="num-main">*</span></div>
                    <div class="num-key" data-key="0"><span class="num-main">0</span></div>
                    <div class="num-key" data-key="#"><span class="num-main">#</span></div>
                </div>

            </div>
        
        </div>
    </div>
</div>

<script>
    /* =========================================
       DATA
       ========================================= */
    const apps = [
        {
            id: 1,
            title: "SteamClock",
            type: "normal", 
            icon: "1.png", 
            image: "https://assets.st-note.com/production/uploads/images/249412945/picture_pc_e67856a041e77ef1d5670b50d1aa2e1f.png", 
            desc: "‰∏ÄÁï™ÊúÄÂàù„Å´‰ΩúÊàê„Åó„Åü„Çπ„ÉÅ„Éº„É†„Éè„Çö„É≥„ÇØÈ¢®ÊôÇË®à„Ç¢„Éï„Çö„É™„Å¶„Çô„Åô„ÄÇ",
            link: "https://note.com/hamamah/n/n55f12e684c13?sub_rt=share_b",
            hasBadge: false
        },
        {
            id: 2,
            title: "CoffeeFactory",
            type: "normal",
            icon: "2.png",
            image: "https://assets.st-note.com/production/uploads/images/249478392/picture_pc_400c563f39f55fa34f7c22ed9154d7e6.png",
            desc: "„Åª„Å£„Å®‰∏ÄÊÅØ„Å§„Åç„Åü„ÅÑÊôÇ„Å´Èñã„Åè„ÄÅÁµµÊú¨„ÅÆ„Çà„ÅÜ„Å™„Ç≥„Éº„Éí„Éº„Çø„Ç§„Éû„Éº„Ç¢„Éï„Çö„É™„Å¶„Çô„Åô„ÄÇ",
            link: "https://note.com/hamamah/n/ndd00e6f70f55?sub_rt=share_b",
            hasBadge: false
        },
        {
            id: 3,
            title: "AmberTime",
            type: "normal",
            icon: "3.png",
            image: "https://assets.st-note.com/production/uploads/images/251298722/picture_pc_41f4941b5fb971116403bf7f36b4075d.png",
            desc: "„Éà„Çô„ÉÉ„ÉàÁµµ„Å¶„Çô‰ΩúÊàê„Åó„Åü„ÄÅÊ≠£Ëß£„ÅÆ„Å™„ÅÑ„Ç¶„Ç§„Çπ„Ç≠„ÉºËí∏ÁïôÊâÄÁµåÂñ∂„Ç±„Çô„Éº„É†„Å¶„Çô„Åô„ÄÇ",
            link: "https://note.com/hamamah/n/n2123726a637c?sub_rt=share_b",
            hasBadge: false
        },
        {
            id: 4,
            title: "IroMix",
            type: "normal",
            icon: "4.png",
            image: "https://assets.st-note.com/production/uploads/images/252445104/picture_pc_6c40578c92817f8aba8bcb82b9874dbe.png",
            desc: "Ëâ≤ÈâõÁ≠Ü„ÅÆÊ∑∑Ëâ≤„Åã„ÇôÊ•Ω„Å´„Å™„Å£„Åü„Çâ„ÅÑ„ÅÑ„Å™„Å®ÊÄù„Å£„Å¶‰Ωú„Å£„Åü„Ç¢„Éï„Çö„É™„Å¶„Çô„Åô„ÄÇ",
            link: "https://note.com/hamamah/n/n56034020d77b",
            hasBadge: false
        },
        {
            id: 5,
            title: "DotCleaner",
            type: "normal",
            icon: "5.png",
            image: " ",
            desc: "AI„Åã„Çô‰ΩúÊàê„Åô„Çã„Éà„Çô„ÉÉ„ÉàÁµµÈ¢®ÁîªÂÉè„ÇíËá™ÂàÜÁî®„Å´‰øÆÊ≠£„Åô„Çã„Åü„ÇÅ„ÅÆ„Ç¢„Éï„Çö„É™„Å¶„Çô„Åô„ÄÇ",
            link: " ",
            hasBadge: true
        },
        /* --- ËøΩÂä†: Profile --- */
        {
            id: 98,
            title: "Profile",
            type: "profile", 
            icon: "Gear.png", 
            desc: "Á´ØÊú´ÊâÄÊúâËÄÖ„ÅÆÊÉÖÂ†±",
            link: "#",
            hasBadge: false
        },
        /* --- ËøΩÂä†: Mail --- */
        {
            id: 99,
            title: "Mail",
            type: "mail", 
            icon: "Mail.png", 
            desc: "Âèó‰ø°„Éõ„Çô„ÉÉ„ÇØ„Çπ",
            link: "#",
            hasBadge: true 
        }
    ];
    // Â£ÅÁ¥ô„Éï„Çö„É™„Çª„ÉÉ„Éà (Unsplash & CSS Gradients)
    const wallpapers = [
        { name: "None", url: "" },
        { name: "Cyber", url: "Cyber.jpg" },
        { name: "Sakura", url: "Sakura.jpg" },
        { name: "Cat", url: "Cat.jpg" },
        { name: "Heart", url: "Heart.jpg" }
    ];
    /* =========================================
       SYSTEM & STATE
       ========================================= */
    let systemState = 'active';
    // active | idle | sleep | dev
    let secretBuffer = "";
    let idleTimer = null;
    let powerHoldTimer = null;
    const IDLE_TIMEOUT_MS = 15000;
    const POWER_HOLD_MS = 2000;
    const START_TIME = Date.now();
    /* =========================================
       APP STATE
       ========================================= */
    let currentPage = 0;
    let cursorIndex = 0;
    let inDetailMode = false;
    let scrollLock = false;
    // Developer Menu State
    let devCursor = 0;
    let currentWallpaperIndex = 0;

    const ITEMS_PER_PAGE = 6;
    function getTotalPages() {
        return Math.max(1, Math.ceil(apps.length / ITEMS_PER_PAGE));
    }

    const gridEl = document.getElementById('app-grid');
    const pageNumEl = document.getElementById('page-num');
    const homeView = document.getElementById('home-view');
    const detailView = document.getElementById('detail-view');
    const detailContent = document.getElementById('detail-content');
    const guideLeft = document.getElementById('guide-left');
    const guideCenter = document.getElementById('guide-center');
    const guideRight = document.getElementById('guide-right');

    const idleOverlay = document.getElementById('idle-overlay');
    const sleepOverlay = document.getElementById('sleep-overlay');
    const devOverlay = document.getElementById('dev-overlay');

    window.onload = () => {
        setTimeout(() => {
            const boot = document.getElementById('boot-screen');
            boot.style.opacity = '0';
            boot.style.transition = 'opacity 0.8s';
            setTimeout(() => { boot.style.display = 'none'; }, 800);
        }, 1500);
        // Load Wallpaper
        const savedWP = localStorage.getItem('sukima_wallpaper_idx');
        if (savedWP !== null) {
            currentWallpaperIndex = parseInt(savedWP);
            applyWallpaper(currentWallpaperIndex);
        }

        renderGrid();
        updateClock();
        resetIdleTimer();
        detailView.addEventListener('wheel', (e) => {
            e.preventDefault();
        }, { passive: false });
        document.querySelectorAll('.num-key').forEach(el => {
            const key = el.getAttribute('data-key');
            el.addEventListener('pointerdown', (e) => {
                e.preventDefault(); 
                handleInput(key);
            }, { passive: false });
        });
    };

    /* --- Wallpaper Logic --- */
    function applyWallpaper(index) {
        if (index < 0 || index >= wallpapers.length) index = 0;
        const wp = wallpapers[index];
        const el = document.getElementById('idle-overlay');
        
        if (wp.url) {
            el.style.backgroundImage = `url('${wp.url}')`;
        } else {
            el.style.backgroundImage = 'none';
        }
    }

    function cycleWallpaper() {
        currentWallpaperIndex = (currentWallpaperIndex + 1) % wallpapers.length;
        localStorage.setItem('sukima_wallpaper_idx', currentWallpaperIndex);
        applyWallpaper(currentWallpaperIndex);
        updateDevMenu();
    }

    /* --- Signal Icon Control --- */
    function setSignal(level, mode='normal') {
        const el = document.getElementById('signal');
        if (!el) return;
        el.dataset.level = String(Math.max(0, Math.min(4, level)));
        el.dataset.mode = mode;
    }

    /* --- OS State Management --- */
    function setSystemState(newState) {
        if (newState === 'sleep') {
            setSignal(0, 'search');
            setTimeout(() => {
                if(systemState === 'sleep') setSignal(0, 'noservice');
            }, 800);
        } else if (newState === 'active' && systemState === 'sleep') {
            setSignal(0, 'search');
            setTimeout(() => {
                if(systemState === 'active') setSignal(4, 'normal');
            }, 1000);
        }

        systemState = newState;
        
        idleOverlay.classList.toggle('visible', newState === 'idle');
        sleepOverlay.classList.toggle('visible', newState === 'sleep');
        devOverlay.classList.toggle('visible', newState === 'dev');

        if (newState === 'active') {
            resetIdleTimer();
            secretBuffer = "";
        } else {
            clearTimeout(idleTimer);
            idleTimer = null;
        }

        if (newState === 'dev') {
            devCursor = 0;
            updateDevMenu();
        }
    }

    function resetIdleTimer() {
        if (systemState !== 'active') return;
        if (idleTimer) clearTimeout(idleTimer);
        idleTimer = setTimeout(() => {
            setSystemState('idle');
        }, IDLE_TIMEOUT_MS);
    }

    function checkSecretCode(key) {
        if (!/^[0-9*#]$/.test(key)) return;
        secretBuffer += key;
        if (secretBuffer.length > 16) secretBuffer = secretBuffer.slice(-16);
        if (secretBuffer.endsWith('*#0000#')) {
            if (!inDetailMode) setSystemState('dev');
            secretBuffer = "";
        }
    }

    /* --- Dev Menu Logic --- */
    function updateDevMenu() {
        const container = document.getElementById('dev-menu-container');
        // Simple menu items
        const items = [
            { label: "Exit Menu", action: "exit" },
            { label: `Wallpaper: ${wallpapers[currentWallpaperIndex].name}`, action: "wallpaper" },
            { label: "System Info", action: "none" }
        ];
        let html = '';
        items.forEach((item, idx) => {
            const selected = (idx === devCursor) ? 'selected' : '';
            const marker = (idx === devCursor) ? '>' : ' ';
            html += `<div class="dev-line dev-item ${selected}"><span>${marker} ${item.label}</span></div>`;
        });
        html += `<div class="dev-line" style="margin-top:10px; color:#050;">Uptime: ${getUptimeStr()}</div>`;
        container.innerHTML = html;
    }

    function handleDevInput(key) {
        if (key === 'up') {
            devCursor = Math.max(0, devCursor - 1);
            updateDevMenu();
        } else if (key === 'down') {
            devCursor = Math.min(2, devCursor + 1);
            // Max 3 items
            updateDevMenu();
        } else if (key === 'enter' || key === 'guide-center' || key === 'right') {
            if (devCursor === 0) setSystemState('active');
            // Exit
            if (devCursor === 1) cycleWallpaper();
        } else if (key === 'soft-left' || key === 'back') {
            setSystemState('active');
        }
    }

    function getUptimeStr() {
        const diff = Math.floor((Date.now() - START_TIME) / 1000);
        const mm = String(Math.floor(diff / 60)).padStart(2, '0');
        const ss = String(diff % 60).padStart(2, '0');
        return `${mm}:${ss}`;
    }

    /* --- Input Handling --- */
    function handleInput(key) {
        // UI Feedback
        let btnId = `btn-${key}`;
        const btn = document.getElementById(btnId);
        if(btn) {
            btn.classList.add('pressed');
            setTimeout(() => btn.classList.remove('pressed'), 100);
        } else if (/^[0-9*#]$/.test(key)) {
             const numKey = document.querySelector(`.num-key[data-key="${key}"]`);
             if(numKey) {
                 numKey.classList.add('pressed');
                 setTimeout(() => numKey.classList.remove('pressed'), 100);
             }
        }

        if (systemState === 'sleep' || systemState === 'idle') {
            setSystemState('active');
            return;
        }

        if (systemState === 'dev') {
            handleDevInput(key);
            return;
        }

        resetIdleTimer();

        // --- ËøΩÂä†: ÈÄöË©±„Éõ„Çô„Çø„É≥„ÅÆÂá¶ÁêÜ ---
        if (key === 'call') {
            // Èö†„Åó„Ç≥„Éû„É≥„Éà„ÇôÁ≠â„ÅÆ„Éï„ÉÉ„ÇØÂ†¥ÊâÄ
            console.log("Call button pressed. Buffer:", secretBuffer);
            
            // Á∞°ÊòìÊºîÂá∫: „Çπ„ÉÜ„Éº„Çø„Çπ„Éè„Çô„Éº„ÅÆÊó•‰ªò„Çí‰∏ÄÁû¨„ÄåCalling...„Äç„Å´„Åô„Çã
            const dateEl = document.getElementById('date-display');
            const originalText = dateEl.textContent;
            dateEl.textContent = "Calling...";
            dateEl.style.color = "#0f0";
            
            setTimeout(() => {
                dateEl.textContent = originalText;
                dateEl.style.color = "";
            }, 1500);
            return;
        }
        // ---------------------------

        if (key === 'power') {
            transitionScreen(() => {
                inDetailMode = false;
                homeView.style.display = 'block';
                detailView.style.display = 'none';
                currentPage = 0;
                cursorIndex = 0;
                renderGrid();
            });
            return;
        }
        
        checkSecretCode(key);
        if (inDetailMode) {
            if (key === 'back' || key === 'soft-left') {
                closeDetail();
                return;
            }
            if (key === 'down') { stepScroll(1); return;
            }
            if (key === 'up')   { stepScroll(-1);
            return; }

            if (key === 'enter' || key === 'guide-center') {
                const container = document.getElementById('detail-view');
                if (container) {
                    openLink();
                }
                return;
            }

        } else {
            const totalPages = getTotalPages();
            const currentItemsCount = apps.slice(currentPage * ITEMS_PER_PAGE, (currentPage + 1) * ITEMS_PER_PAGE).length;
            if (key === 'soft-left' || key === '1') {
                currentPage = (currentPage - 1 + totalPages) % totalPages;
                cursorIndex = 0;
                renderGrid();
            } else if (key === 'soft-right' || key === '3') {
                currentPage = (currentPage + 1) % totalPages;
                cursorIndex = 0;
                renderGrid();
            } else if (key === 'right') {
                if (cursorIndex < currentItemsCount - 1) {
                    cursorIndex++;
                    renderGrid();
                } else {
                    if (currentPage < totalPages - 1) {
                        transitionScreen(() => {
                            currentPage++;
                 
                            cursorIndex = 0;
                            renderGrid();
                        });
                    }
                }
            } else if (key === 'left') {
                if (cursorIndex > 0) {
                    cursorIndex--;
                    renderGrid();
                } else {
                    if (currentPage > 0) {
                        transitionScreen(() => {
                            currentPage--;
                   
                            cursorIndex = ITEMS_PER_PAGE - 1;
                            renderGrid();
                        });
                    }
                }
            } else if (key === 'down') {
                if (cursorIndex + 3 < currentItemsCount) {
                    cursorIndex += 3;
                    renderGrid();
                }
            } else if (key === 'up') {
                if (cursorIndex - 3 >= 0) {
                    cursorIndex -= 3;
                    renderGrid();
                }
            } else if (key === 'enter') {
                openDetail();
            }
        }
    }

    /* --- Rendering & Animation --- */
    function renderGrid() {
        gridEl.innerHTML = '';
        const totalPages = getTotalPages();
        if (currentPage > totalPages - 1) currentPage = totalPages - 1;
        const start = currentPage * ITEMS_PER_PAGE;
        const end = start + ITEMS_PER_PAGE;
        const pageApps = apps.slice(start, end);
        pageApps.forEach((app, index) => {
            const div = document.createElement('div');
            div.className = `app-icon ${index === cursorIndex ? 'selected' : ''}`;

            const iconHTML = app.icon
                ? `<img class="icon-png" src="${app.icon}">`
                : `<span class="icon-fallback">üì±</span>`;
         
            // Badge Logic
            const badgeHTML = app.hasBadge ? `<div class="app-badge"></div>` : '';

            div.innerHTML = `
                ${badgeHTML}
                <div class="icon-img">${iconHTML}</div>
                
                <div class="icon-label">${app.title}</div>
            `;

            div.onclick = () => {
                cursorIndex = index;
                renderGrid();
                openDetail();
            };
         
            gridEl.appendChild(div);
        });
        pageNumEl.textContent = `${currentPage + 1}/${totalPages}`;
        updateGuide();
    }

    function transitionScreen(callback) {
        if (inDetailMode) detailView.style.opacity = '0';
        else homeView.style.opacity = '0';

        setTimeout(() => {
            callback();
            if (inDetailMode) detailView.style.opacity = '1';
            else homeView.style.opacity = '1';
        }, 100);
    }

    function playLoadingAnimation() {
        const curtain = document.getElementById('loading-curtain');
        if (!curtain) return;
        curtain.style.transition = 'none';
        curtain.style.height = '100%';
        let height = 100;
        const interval = setInterval(() => {
            if (Math.random() < 0.15) return;
            if (Math.random() < 0.05) height += Math.random() * 4;
            else height -= Math.random() * 3;
            if (height <= 0) {
                height = 0;
        
                clearInterval(interval);
            }
            if (height > 100) height = 100;
            curtain.style.height = height + '%';
        }, 60);
    }

    function isAtBottom(el, thresholdPx = 6) {
        if (el.scrollHeight <= el.clientHeight) return true;
        return (el.scrollTop + el.clientHeight) >= (el.scrollHeight - thresholdPx);
    }

    function updateDetailFocusByScroll() {
        const container = document.getElementById('detail-view');
        const linkItem = document.getElementById('detail-item-link'); 
        if (!container || !linkItem) return;
        const focused = isAtBottom(container, 6);
        linkItem.classList.toggle('focused', focused);
        guideCenter.textContent = focused ?
        "Èñã„Åè" : "‚Äî";
    }

    function stepScroll(direction) {
        const container = document.getElementById('detail-view');
        if (!container) return;
        if (scrollLock) return;
        scrollLock = true;
        container.scrollTop += direction * 12;
        setTimeout(() => { scrollLock = false; }, 80);
    }

    function openDetail() {
        transitionScreen(() => {
            const appIndex = currentPage * ITEMS_PER_PAGE + cursorIndex;
            if (appIndex >= apps.length) return;
            inDetailMode = true;

            const app = apps[appIndex];
            
            // --- Type„Å´„Çà„ÇãÂàÜÂ≤ê ---
            if (app.type === 'profile') {
                // „Éï„Çö„É≠„Éï„Ç£„Éº„É´ÁîªÈù¢
                detailContent.innerHTML = `
                    <div class="detail-title">Device Info</div>
                    <div class="detail-desc" style="font-family:monospace; font-size:11px;">
                        <span style="color:#888;">OWNER:</span> hamamah<br>
                        <span style="color:#888;">LOC:</span> Skopje<br>
                        <span style="color:#888;">DEVICE:</span> SukimaStock OS<br>
                        <span style="color:#888;">BUILD:</span> wallpaper_mod<br>
                        <span style="color:#888;">UPTIME:</span> ${getUptimeStr()}<br>
                        <hr style="border:0; border-top:1px dashed #333; margin:10px 0;">
                        „Çà„ÅÜ„Åì„Åù„ÄÇ<br>
                        „Åì„Åì„ÅØÁßÅ„ÅÆÂà∂‰ΩúÁâ©„Çí‰øùÁÆ°„Åô„Çã<br>
                        Â∞è„Åï„Å™Êõ∏Â∫´„ÅÆ„Çà„ÅÜ„Å™Â†¥ÊâÄ„Å¶„Çô„Åô„ÄÇ
                    </div>
                    <div style="height:20px;"></div>
                `;
            } else if (app.type === 'mail') {
                // „É°„Éº„É´ÁîªÈù¢
                detailContent.innerHTML = `
                    <div class="detail-title">Inbox (1)</div>
                    <div class="detail-desc">
                        <div style="background:#222; padding:5px; border-radius:4px; margin-bottom:10px;">
                            <span style="color:#aaa;">From:</span> hamamah<br>
                            <span style="color:#aaa;">Sub:</span> Welcome
                        </div>
                        „Åì„ÅÆOS„Å∏„Çà„ÅÜ„Åì„Åù„ÄÇ<br><br>
                        „Åì„Åì„ÅØÂÖ¨Èñã„Åó„Å™„Åè„Å¶„ÇÇ„ÅÑ„ÅÑ„Ç¢„Éï„Çö„É™„Åü„Å°„ÅÆÈùô„Åã„Å™ÂÆüÈ®ìÂÆ§„Å¶„Çô„Åô„ÄÇ<br>
                        „ÇÜ„Å£„Åè„Çä„Åó„Å¶„ÅÑ„Å£„Å¶„Åè„Åü„Çô„Åï„ÅÑ„ÄÇ<br><br>
                        („Åì„ÅÆ„É°„Éº„É´„ÅØËøî‰ø°„Å¶„Çô„Åç„Åæ„Åõ„Çì)
                    </div>
                    <div style="height:20px;"></div>
                `;
            } else {
                // ÈÄöÂ∏∏„ÅÆ„Ç¢„Éï„Çö„É™ÁîªÈù¢ (Êó¢Â≠ò„É≠„Ç∑„Çô„ÉÉ„ÇØ)
                const imgUrl = app.image && app.image.trim() !== "" 
                    ? app.image 
                    : 'https://via.placeholder.com/240x160/222/555?text=NO+IMAGE';
                 
                detailContent.innerHTML = `
                    <div class="detail-title">${app.title}</div>
                    <div class="detail-item">
                        <div class="img-container">
                            <img src="${imgUrl}" class="detail-img">
                            <div id="loading-curtain" class="img-curtain"></div>
                        </div>
                    </div>
                    <div class="detail-desc">${app.desc.replace(/\n/g, '<br>')}</div>
                    
                    ${app.link && app.link !== "#" ? `
                    <div id="detail-item-link" class="detail-item">
                        <a href="${app.link}" class="note-link" id="target-link">NoteË®ò‰∫ã„ÇíË™≠„ÇÄ</a>
                    </div>` : ''}
                    
                    <div style="height:20px;"></div>
                `;
            }

            homeView.style.display = 'none';
            detailView.style.display = 'block';
            updateGuide();
            
            setTimeout(() => {
                updateDetailFocusByScroll();
                playLoadingAnimation();
            }, 50);
            detailView.onscroll = () => updateDetailFocusByScroll();
        });
    }

    function closeDetail() {
        transitionScreen(() => {
            inDetailMode = false;
            homeView.style.display = 'block';
            detailView.style.display = 'none';
            updateGuide();
            detailView.onscroll = null;
        });
    }

    function updateGuide() {
        if (inDetailMode) {
            guideLeft.textContent = "Êàª„Çã";
            guideRight.textContent = "";
            guideCenter.textContent = "‚Äî"; 
        } else {
            guideLeft.textContent = "‚óÄÔ∏é Ââç„Å∏";
            guideCenter.textContent = "Ê±∫ÂÆö";
            guideRight.textContent = "Ê¨°„Å∏ ‚ñ∂Ô∏é";
        }
    }

    function openLink() {
        // ÁèæÂú®„ÅÆ„Ç¢„Éï„Çö„É™„ÇíÂèñÂæó„Åó„Å¶„ÄÅ„É™„É≥„ÇØ„Åã„Çô„Å™„ÅÑ(Profile/MailÁ≠â)„Å™„ÇâÁÑ°Ë¶ñ
        const appIndex = currentPage * ITEMS_PER_PAGE + cursorIndex;
        if (appIndex < apps.length) {
            const app = apps[appIndex];
            if (!app.link || app.link === "#") return;
        }

        const link = document.getElementById('target-link');
        if(link && link.getAttribute('href') !== '#') {
            // Êé•Á∂öÊºîÂá∫
            const overlay = document.getElementById('connect-overlay');
            if(overlay) {
                overlay.style.display = 'flex'; // Ë°®Á§∫
                
                // 1.5ÁßíÂæå„Å´ÈÅ∑Áßª
                setTimeout(() => {
                    window.open(link.href, '_blank');
                    // ÈÅ∑ÁßªÂæå„Å´„Ç™„Éº„Éè„Çô„Éº„É¨„Ç§„ÇíÈö†„Åô(Êàª„Å£„Å¶„Åç„ÅüÊôÇÁî®)
                    setTimeout(() => {
                        overlay.style.display = 'none';
                    }, 500);
                }, 1500);
            } else {
                // „Ç™„Éº„Éè„Çô„Éº„É¨„Ç§„Åã„Çô„Å™„ÅÑÂ†¥Âêà„ÅÆ„Éï„Ç©„Éº„É´„Éè„Çô„ÉÉ„ÇØ
                window.open(link.href, '_blank');
            }
        }
    }

    const HOLD_DELAY = 250;
    const HOLD_INTERVAL = 70;
    function attachHoldRepeat(el, key) {
        if (!el) return;
        if (key === 'power') {
            attachPowerHoldSleep(el);
            return;
        }

        let holdTimeout = null;
        let holdInterval = null;
        let holding = false;
        const clearHold = () => {
            holding = false;
            if (holdTimeout) { clearTimeout(holdTimeout); holdTimeout = null; }
            if (holdInterval) { clearInterval(holdInterval);
            holdInterval = null; }
            el.classList.remove('pressed');
        };
        const startHold = (e) => {
            e.preventDefault();
            if (holding) return;
            holding = true;
            handleInput(key); 
            el.classList.add('pressed');
            holdTimeout = setTimeout(() => {
                holdInterval = setInterval(() => handleInput(key), HOLD_INTERVAL);
            }, HOLD_DELAY);
        };

        el.addEventListener('pointerdown', startHold, { passive: false });
        el.addEventListener('pointerup', clearHold);
        el.addEventListener('pointerleave', clearHold);
        el.addEventListener('pointercancel', clearHold);
    }

    function attachPowerHoldSleep(el) {
        if (!el) return;
        let pressTimer = null;
        
        const start = (e) => {
            e.preventDefault();
            el.classList.add('pressed');
            pressTimer = setTimeout(() => {
                pressTimer = null;
                el.classList.remove('pressed');
                setSystemState('sleep');
            }, POWER_HOLD_MS);
        };

        const end = (e) => {
            if (pressTimer) {
                clearTimeout(pressTimer);
                pressTimer = null;
                el.classList.remove('pressed');
                handleInput('power');
            }
        };

        el.addEventListener('pointerdown', start, { passive: false });
        el.addEventListener('pointerup', end);
        el.addEventListener('pointerleave', () => {
             if (pressTimer) { clearTimeout(pressTimer); pressTimer = null; el.classList.remove('pressed'); }
        });
    }

    // 'call' „ÇíËøΩÂä†
    const keys = ['up','down','left','right','enter','back','soft-left','soft-right','power', 'call'];
    keys.forEach(k => {
        const el = document.getElementById(`btn-${k}`);
        if (!el) return;
        attachHoldRepeat(el, k);
    });
    document.addEventListener('keydown', (e) => {
        if (e.repeat) return; 

        switch(e.key) {
            case 'ArrowUp': e.preventDefault(); handleInput('up'); return;
            case 'ArrowDown': e.preventDefault(); handleInput('down'); return;
            case 'ArrowLeft': handleInput('left'); return;
            case 'ArrowRight': handleInput('right'); return;
            case 'Enter': handleInput('enter'); 
            return;
            case 'Backspace': handleInput('back'); return;
            case 'Escape': handleInput('power'); return;
            case '1': handleInput('soft-left'); return; 
            case '3': handleInput('soft-right'); return; 
        }

        if (/^[0-9*#]$/.test(e.key)) {
            handleInput(e.key);
        
            return;
        }

        if (systemState !== 'active') {
            setSystemState('active');
        }
    });
    function updateClock() {
        const now = new Date();
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const month = now.getMonth() + 1;
        const monthName = months[now.getMonth()];
        const date = now.getDate();
        const day = days[now.getDay()];
        const h = String(now.getHours()); 
        const m = String(now.getMinutes()).padStart(2, '0');
        const timeStr = `${h}:${m}`;
        
        document.getElementById('date-display').textContent = `${month}/${date} ${day}`;
        document.getElementById('clock').textContent = timeStr;
        // Idle Screen Logic
        document.getElementById('idle-clock-disp').textContent = timeStr;
        const idleDateEl = document.getElementById('idle-date-disp');
        if(idleDateEl) idleDateEl.textContent = `${monthName} ${date}, ${day}`;
        
        document.getElementById('sleep-clock-disp').textContent = timeStr;
        if (systemState === 'dev') {
           updateDevMenu();
           // Update uptime
        }
    }
    setInterval(updateClock, 1000);
</script>
</body>
</html>
